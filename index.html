<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRM | Systematic Review Manager</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #ffffff;
            --text: #000000;
            --border: #000000;
            --gray: #f4f4f4;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
        
        h1, h2, h3, h4 { font-family: 'Barlow Condensed', sans-serif; text-transform: uppercase; letter-spacing: 1px; }

        /* --- UI COMPONENTS --- */
        .btn {
            background: black; color: white; border: none; padding: 12px 20px;
            font-family: 'Barlow Condensed'; font-weight: 700; cursor: pointer;
            text-transform: uppercase; transition: var(--transition);
        }
        .btn:hover { opacity: 0.8; transform: translateY(-1px); }
        .btn-outline { background: transparent; color: black; border: 2px solid black; }

        input, textarea {
            width: 100%; padding: 12px; border: 2px solid black;
            font-family: 'Poppins'; outline: none;
        }

        /* --- DASHBOARD --- */
        #view-dashboard { padding: 40px 20px; max-width: 1000px; margin: 0 auto; }
        .project-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .project-card { 
            border: 2px solid black; padding: 20px; cursor: pointer; 
            transition: var(--transition); position: relative;
        }
        .project-card:hover { background: var(--gray); }
        .delete-proj { position: absolute; top: 10px; right: 10px; color: red; cursor: pointer; font-weight: bold; }

        /* --- HEADER & HAMBURGER --- */
        .header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 20px; border-bottom: 2px solid black; sticky: top; background: white; z-index: 1000;
        }
        .nav-toggle { font-size: 24px; cursor: pointer; display: block; }
        
        /* Side Menu */
        .side-menu {
            position: fixed; top: 0; left: -300px; width: 300px; height: 100%;
            background: white; border-right: 2px solid black; z-index: 2000;
            transition: var(--transition); padding: 20px; overflow-y: auto;
        }
        .side-menu.open { left: 0; }
        .menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1500; display: none;
        }
        .menu-overlay.show { display: block; }
        
        .nav-list { list-style: none; margin-top: 30px; }
        .nav-list li { margin-bottom: 10px; }
        .nav-list a { 
            text-decoration: none; color: black; font-family: 'Barlow Condensed';
            font-weight: 600; font-size: 1.2rem; display: block; padding: 5px;
        }
        .nav-list a:hover { background: var(--gray); }

        /* --- PROJECT VIEW --- */
        #view-project { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .section-card { border: 2px solid black; margin-bottom: 40px; scroll-margin-top: 100px; }
        .section-header { background: black; color: white; padding: 15px; display: flex; justify-content: space-between; }
        .section-body { padding: 20px; display: flex; flex-direction: column; gap: 20px; }

        /* Smart Editor */
        .editor-container { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 900px) { .editor-container { grid-template-columns: 1fr 1fr; } }
        .smart-input { min-height: 250px; font-size: 14px; }
        .rendered-view { border: 1px solid #ddd; padding: 15px; background: white; min-height: 250px; overflow-x: auto; }
        
        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; font-size: 0.9rem; }
        th { background: #eee; }

        /* Progress Bar */
        .progress-bar-container { height: 8px; background: #ddd; width: 100%; margin: 10px 0; }
        .progress-fill { height: 100%; background: black; width: 0%; transition: width 0.5s; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
    <nav class="side-menu" id="sideMenu">
        <h2 onclick="goDashboard()" style="cursor:pointer">← Dashboard</h2>
        <ul class="nav-list" id="navLinks">
            </ul>
    </nav>

    <header class="header">
        <div class="nav-toggle" id="hamburger" onclick="toggleMenu()">☰</div>
        <h2 id="current-project-name">SYSTEMATIC REVIEW MANAGER</h2>
        <button class="btn btn-outline" onclick="goDashboard()">ALL PROJECTS</button>
    </header>

    <div id="view-dashboard">
        <h1>My Reviews</h1>
        <p>Create and manage your systematic review projects.</p>
        
        <div style="border: 2px solid black; padding: 20px; margin-top: 20px;">
            <h3>Start New Project</h3>
            <input type="text" id="new-title" placeholder="Review Title..." style="margin: 10px 0;">
            <textarea id="new-desc" placeholder="Brief description..." style="margin-bottom: 10px; height: 80px;"></textarea>
            <button class="btn" onclick="createNewProject()">CREATE PROJECT</button>
        </div>

        <div class="project-grid" id="projectGrid">
            </div>
    </div>

    <div id="view-project">
        <div id="project-meta">
            <h1 id="display-title">Project Title</h1>
            <p id="display-desc">Description goes here...</p>
            <div class="progress-bar-container">
                <div class="progress-fill" id="main-progress"></div>
            </div>
            <p style="font-size: 0.8rem; font-weight: bold;">TOTAL COMPLETION: <span id="progress-text">0%</span></p>
        </div>
        <hr style="margin: 30px 0; border: 1px solid black;">
        
        <div id="sections-container">
            </div>
    </div>

    <script>
        // --- DATA STRUCTURE ---
        const SECTIONS_CONFIG = [
            { id: "pico", title: "PICO", prompt: "Define Population, Intervention, Comparison, Outcome.", link: "https://example.com/pico" },
            { id: "feasibility", title: "Preliminary Feasibility Check", prompt: "Initial search findings and study volume notes.", link: "#" },
            { id: "protocol", title: "PROTOCOL", prompt: "Draft your PROSPERO or internal protocol.", link: "#" },
            { id: "search", title: "Search", prompt: "Input search strings and databases used.", link: "#" },
            { id: "abs-screen", title: "Titles/Abstract Screening", prompt: "Record inclusion/exclusion at abstract level.", link: "#" },
            { id: "full-screen", title: "Full Text Screening", prompt: "Record reasons for full-text exclusion.", link: "#" },
            { id: "prisma", title: "PRISMA", prompt: "Flowchart data counts.", link: "#" },
            { id: "data-ext", title: "Data Extraction", prompt: "Use JSON format here for table rendering.", link: "#" },
            { id: "missing", title: "Missing Data", prompt: "Contact logs for missing information.", link: "#" },
            { id: "abstract", title: "Abstract", prompt: "Draft final manuscript abstract.", link: "#" },
            { id: "title-page", title: "Title Page", prompt: "Author details and affiliations.", link: "#" },
            { id: "intro", title: "Introduction", prompt: "Rationale and objectives.", link: "#" },
            { id: "methods", title: "Methods", prompt: "Detailed methodology description.", link: "#" },
            { id: "results", title: "Results", prompt: "Findings and statistical data.", link: "#" },
            { id: "discussion", title: "Discussion", prompt: "Limitations and conclusions.", link: "#" }
        ];

        let projects = JSON.parse(localStorage.getItem('SRM_PROJECTS')) || [];
        let activeProjectId = null;

        // --- NAVIGATION ---
        function toggleMenu() {
            document.getElementById('sideMenu').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }

        function goDashboard() {
            activeProjectId = null;
            document.getElementById('view-dashboard').classList.remove('hidden');
            document.getElementById('view-project').style.display = 'none';
            document.getElementById('sideMenu').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('hamburger').classList.add('hidden');
            renderDashboard();
        }

        // --- DASHBOARD LOGIC ---
        function createNewProject() {
            const title = document.getElementById('new-title').value;
            const desc = document.getElementById('new-desc').value;
            if(!title) return alert("Please enter a title");

            const newProj = {
                id: Date.now(),
                title: title,
                desc: desc,
                data: {} // Stores content for the 15 sections
            };

            projects.push(newProj);
            save();
            document.getElementById('new-title').value = '';
            document.getElementById('new-desc').value = '';
            renderDashboard();
        }

        function renderDashboard() {
            const grid = document.getElementById('projectGrid');
            grid.innerHTML = '';
            projects.forEach(p => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <span class="delete-proj" onclick="deleteProject(event, ${p.id})">✕</span>
                    <h3>${p.title}</h3>
                    <p style="font-size: 0.8rem; color: #555;">${p.desc.substring(0, 60)}...</p>
                `;
                card.onclick = () => openProject(p.id);
                grid.appendChild(card);
            });
        }

        function deleteProject(e, id) {
            e.stopPropagation();
            if(confirm("Delete this project?")) {
                projects = projects.filter(p => p.id !== id);
                save();
                renderDashboard();
            }
        }

        // --- PROJECT LOGIC ---
        function openProject(id) {
            activeProjectId = id;
            const project = projects.find(p => p.id === id);
            
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-project').style.display = 'block';
            document.getElementById('hamburger').classList.remove('hidden');
            
            document.getElementById('display-title').innerText = project.title;
            document.getElementById('display-desc').innerText = project.desc;
            
            renderSections(project);
            renderSidebarLinks();
            updateProgress();
        }

        function renderSections(project) {
            const container = document.getElementById('sections-container');
            container.innerHTML = '';

            SECTIONS_CONFIG.forEach((sec, index) => {
                const savedVal = project.data[sec.id] || "";
                const sectionHtml = `
                    <section class="section-card" id="scroll-${sec.id}">
                        <div class="section-header">
                            <h3>${index + 1}. ${sec.title}</h3>
                        </div>
                        <div class="section-body">
                            <div>
                                <strong>PROMPT:</strong>
                                <div style="background:#f9f9f9; padding:10px; border:1px solid #ccc; margin:5px 0; font-size:0.9rem;">
                                    <span id="txt-${sec.id}">${sec.prompt}</span>
                                    <br><button class="btn btn-outline" style="padding:4px 8px; font-size:10px; margin-top:5px;" onclick="copyText('txt-${sec.id}')">COPY PROMPT</button>
                                </div>
                            </div>
                            <a href="${sec.link}" target="_blank" style="color:black; font-size:0.8rem; font-weight:bold;">RELEVANT RESOURCE LINK</a>
                            <div class="editor-container">
                                <textarea class="smart-input" oninput="handleInput(this, '${sec.id}')" placeholder="Enter text or JSON...">${savedVal}</textarea>
                                <div class="rendered-view" id="render-${sec.id}">${parseContent(savedVal)}</div>
                            </div>
                        </div>
                    </section>
                `;
                container.insertAdjacentHTML('beforeend', sectionHtml);
            });
        }

        function renderSidebarLinks() {
            const navLinks = document.getElementById('navLinks');
            navLinks.innerHTML = '';
            SECTIONS_CONFIG.forEach(sec => {
                navLinks.insertAdjacentHTML('beforeend', `
                    <li><a href="#scroll-${sec.id}" onclick="toggleMenu()">${sec.title}</a></li>
                `);
            });
        }

        // --- EDITOR LOGIC ---
        function handleInput(el, secId) {
            const val = el.value;
            const project = projects.find(p => p.id === activeProjectId);
            project.data[secId] = val;
            
            document.getElementById(`render-${secId}`).innerHTML = parseContent(val);
            save();
            updateProgress();
        }

        function parseContent(text) {
            if(!text) return `<span style="color:#999 italic">Empty section...</span>`;
            
            // JSON to Table
            if(text.trim().startsWith('[') && text.trim().endsWith(']')) {
                try {
                    const data = JSON.parse(text);
                    let html = '<table><thead><tr>';
                    Object.keys(data[0]).forEach(k => html += `<th>${k}</th>`);
                    html += '</tr></thead><tbody>';
                    data.forEach(row => {
                        html += '<tr>';
                        Object.values(row).forEach(v => html += `<td>${v}</td>`);
                        html += '</tr>';
                    });
                    return html + '</tbody></table>';
                } catch(e) {}
            }

            // Simple Markdown (Bold/Italic/Headers)
            return text
                .replace(/^# (.*$)/gim, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                .replace(/\n/g, '<br>');
        }

        function updateProgress() {
            const project = projects.find(p => p.id === activeProjectId);
            const total = SECTIONS_CONFIG.length;
            let count = 0;
            SECTIONS_CONFIG.forEach(sec => {
                if(project.data[sec.id] && project.data[sec.id].trim().length > 0) count++;
            });
            const pct = Math.round((count/total)*100);
            document.getElementById('main-progress').style.width = pct + '%';
            document.getElementById('progress-text').innerText = pct + '%';
        }

        function copyText(id) {
            const t = document.getElementById(id).innerText;
            navigator.clipboard.writeText(t);
        }

        function save() {
            localStorage.setItem('SRM_PROJECTS', JSON.stringify(projects));
        }

        // Init
        goDashboard();
    </script>
</body>
</html>
