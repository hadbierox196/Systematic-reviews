<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRM | Systematic Review Manager</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #ffffff;
            --surface: #ffffff;
            --text: #000000;
            --border: #000000;
            --gray: #f4f4f4;
            --accent: #000000;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Mode Colors */
        [data-theme="dark"] {
            --bg: #000000;
            --surface: #121212;
            --text: #ffffff;
            --border: #ffffff;
            --gray: #1e1e1e;
            --accent: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); transition: background var(--transition), color var(--transition); }
        
        h1, h2, h3, h4 { font-family: 'Barlow Condensed', sans-serif; text-transform: uppercase; letter-spacing: 1px; }

        /* --- UI COMPONENTS --- */
        .btn {
            background: var(--text); color: var(--bg); border: none; padding: 12px 20px;
            font-family: 'Barlow Condensed'; font-weight: 700; cursor: pointer;
            text-transform: uppercase; transition: var(--transition);
        }
        .btn:hover { opacity: 0.8; }
        .btn-outline { background: transparent; color: var(--text); border: 2px solid var(--border); }

        input, textarea {
            width: 100%; padding: 12px; border: 2px solid var(--border);
            font-family: 'Poppins'; outline: none; background: var(--surface); color: var(--text);
        }

        /* --- HEADER --- */
        .header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 20px; border-bottom: 2px solid var(--border); 
            position: sticky; top: 0; background: var(--bg); z-index: 1000;
        }
        .nav-controls { display: flex; align-items: center; gap: 15px; }
        .hamburger { font-size: 24px; cursor: pointer; }
        .theme-toggle { cursor: pointer; font-size: 20px; border: none; background: none; color: var(--text); }

        /* --- SIDE MENU --- */
        .side-menu {
            position: fixed; top: 0; left: -300px; width: 300px; height: 100%;
            background: var(--bg); border-right: 2px solid var(--border); z-index: 2000;
            transition: var(--transition); padding: 20px; overflow-y: auto;
        }
        .side-menu.open { left: 0; }
        .menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1500; display: none;
        }
        .menu-overlay.show { display: block; }
        .nav-list { list-style: none; margin-top: 30px; }
        .nav-list a { 
            text-decoration: none; color: var(--text); font-family: 'Barlow Condensed';
            font-weight: 600; font-size: 1.1rem; display: block; padding: 10px;
            border-bottom: 1px solid var(--gray);
        }
        .nav-list a.active { background: var(--text); color: var(--bg); }

        /* --- VIEWS --- */
        #view-dashboard, #view-project { padding: 40px 20px; max-width: 1000px; margin: 0 auto; }
        .project-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .project-card { border: 2px solid var(--border); padding: 20px; cursor: pointer; position: relative; }
        .project-card:hover { background: var(--gray); }

        /* --- SINGLE SECTION VIEW --- */
        .section-view { display: none; animation: fadeIn 0.4s ease; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .editor-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        @media (min-width: 900px) { .editor-grid { grid-template-columns: 1fr 1fr; } }
        
        .rendered-view { 
            border: 1px solid var(--border); padding: 20px; background: var(--surface); 
            min-height: 300px; overflow-x: auto;
        }
        
        /* Table Styles (Dark Mode Compatible) */
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid var(--border); padding: 10px; text-align: left; }
        th { background: var(--gray); }

        .progress-bar { height: 6px; background: var(--gray); width: 100%; margin: 15px 0; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--text); width: 0%; transition: width 0.5s; }

        .hidden { display: none !important; }
    </style>
</head>
<body data-theme="light">

    <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
    <nav class="side-menu" id="sideMenu">
        <h2 onclick="goDashboard()" style="cursor:pointer; margin-bottom: 20px;">← Dashboard</h2>
        <div id="project-nav-header">
            <h4 style="opacity: 0.6;">Project Sections</h4>
            <div class="progress-bar"><div class="progress-fill" id="side-progress"></div></div>
        </div>
        <ul class="nav-list" id="navLinks"></ul>
    </nav>

    <header class="header">
        <div class="nav-controls">
            <div class="hamburger hidden" id="hamburger" onclick="toggleMenu()">☰</div>
            <h2 id="app-heading">SYSTEMATIC REVIEW MANAGER</h2>
        </div>
        <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()">◑</button>
    </header>

    <div id="view-dashboard">
        <h1>Welcome</h1>
        <p>Create a new systematic review to begin.</p>
        
        <div style="border: 2px solid var(--border); padding: 25px; margin: 30px 0; background: var(--surface);">
            <h3>Start New Project</h3>
            <input type="text" id="new-title" placeholder="Project Title (e.g., Efficacy of HIIT in Diabetes)..." style="margin: 15px 0;">
            <textarea id="new-desc" placeholder="Brief project description or research question..." style="margin-bottom: 15px; height: 100px;"></textarea>
            <button class="btn" onclick="createNewProject()">CREATE PROJECT</button>
        </div>

        <h2 style="margin-top: 40px;">Your Projects</h2>
        <div class="project-grid" id="projectGrid"></div>
    </div>

    <div id="view-project" class="hidden">
        <div id="section-container">
            </div>
        
        <div style="margin-top: 40px; border-top: 1px solid var(--gray); padding-top: 20px; display: flex; justify-content: space-between;">
            <button class="btn btn-outline" id="prevBtn" onclick="navigateSection(-1)">← Previous</button>
            <button class="btn btn-outline" id="nextBtn" onclick="navigateSection(1)">Next →</button>
        </div>
    </div>

    <script>
        const SECTIONS = [
            { id: "pico", title: "PICO", prompt: "Outline PICO criteria.", link: "#" },
            { id: "feasibility", title: "Feasibility Check", prompt: "Initial volume of evidence notes.", link: "#" },
            { id: "protocol", title: "Protocol", prompt: "You are an expert systematic review methodologist specializing in PROSPERO protocol development. Generate a complete, publication-ready PROSPERO protocol document based on the PICO framework I provide.

**MY PICO FRAMEWORK:**

Population: [INSERT]
Intervention: [INSERT]
Comparator: [INSERT]
Outcomes: [INSERT]
Study Design: [INSERT]

**ADDITIONAL INFORMATION:**
- Review title: [INSERT or "Generate suggestions"]
- Target completion date: [INSERT]
- Team members: [INSERT or "Me + 1 second reviewer + 1 statistician"]
- Funding: [INSERT or "None"]
- Specialty area: [INSERT, e.g., cardiology, oncology, neurology]

---

**TASK:** Generate a complete PROSPERO protocol document with ALL sections below. Use professional academic language suitable for direct submission to PROSPERO.

---

**SECTION 1: REVIEW IDENTIFIERS**

1. Review title (provide 2 alternatives: one concise, one descriptive)
2. Short title/running head (50 characters max)
3. Named contact information template
4. Review team members and roles template
5. Funding sources statement
6. Conflicts of interest statement

---

**SECTION 2: REVIEW QUESTION & OBJECTIVES**

7. Primary research question (structured format)
8. Primary objective (clear, focused statement)
9. Secondary objectives (3-5 specific objectives)
10. PICO table (formatted for PROSPERO)

---

**SECTION 3: SEARCHES**

11. Information sources (complete list of databases)
12. Search strategy description (narrative overview)
13. Date range justification
14. Language restrictions (with justification)
15. Grey literature sources (specific conferences, registries, etc.)
16. Hand-searching strategy
17. Search update plans

---

**SECTION 4: ELIGIBILITY CRITERIA**

18. Types of studies (detailed inclusion criteria)
19. Types of participants (detailed with diagnostic criteria)
20. Types of interventions (comprehensive specification)
21. Types of comparators (all eligible controls)
22. Timing (treatment duration, follow-up requirements)
23. Setting (all eligible contexts)
24. Exclusion criteria (comprehensive list with rationale)

---

**SECTION 5: OUTCOMES**

25. Primary outcome
    - Name and definition
    - Measurement instrument/method
    - Metric (e.g., mean change, rate, proportion)
    - Timepoints of interest
    - Minimal clinically important difference (if known)

26. Secondary outcomes (list 5-8 outcomes)
    - Clinical outcomes (with instruments)
    - Biomarker/mechanistic outcomes
    - Safety outcomes
    - Quality of life outcomes
    - Health economics outcomes (if applicable)

For each outcome provide:
- Clear definition
- Measurement method
- Timepoints
- How data will be analyzed

---

**SECTION 6: DATA EXTRACTION**

27. Study selection process (detailed workflow)
28. Data extraction process (who, how, software)
29. Data items to be extracted (comprehensive list organized by category):
    - Study characteristics
    - Population characteristics
    - Intervention details
    - Comparator details
    - Outcome data
    - Risk of bias elements
    - Other relevant items

30. Missing data handling strategy
31. Data checking procedures

---

**SECTION 7: RISK OF BIAS ASSESSMENT**

32. Tool selection (RoB 2.0 for RCTs, ROBINS-I for non-randomized, etc.)
33. Domains to be assessed (list all)
34. Process (independent dual assessment, conflict resolution)
35. How risk of bias will inform synthesis

---

**SECTION 8: DATA SYNTHESIS**

36. Criteria for meta-analysis (when quantitative synthesis is appropriate)
37. Effect measures (SMD, MD, RR, OR, HR as applicable)
38. Synthesis methods:
    - Statistical model (random-effects, fixed-effect)
    - Heterogeneity assessment (I², tau², Q-test, prediction intervals)
    - Software to be used

39. Dealing with multi-arm trials
40. Dealing with cluster-randomized trials (if applicable)
41. Unit of analysis issues

---

**SECTION 9: SUBGROUP & SENSITIVITY ANALYSES**

42. Pre-specified subgroup analyses (list 5-8 with rationale):
    - Clinical subgroups
    - Methodological subgroups
    - Intervention characteristic subgroups

43. Pre-specified sensitivity analyses (list 5-8):
    - Risk of bias exclusions
    - Statistical model variations
    - Imputed data exclusions
    - Study design exclusions
    - Other relevant sensitivity analyses

44. Statistical tests for subgroup differences

---

**SECTION 10: META-BIASES**

45. Publication bias assessment:
    - Funnel plots (with interpretation caveats for small N)
    - Egger's test (threshold for application)
    - Trim-and-fill analysis
    
46. Selective outcome reporting assessment
47. Language bias considerations
48. Citation bias considerations

---

**SECTION 11: CERTAINTY OF EVIDENCE**

49. GRADE assessment approach
50. Domains to be evaluated:
    - Risk of bias
    - Inconsistency
    - Indirectness
    - Imprecision
    - Publication bias
    - Large effect
    - Dose-response
    - Plausible confounding
    
51. Summary of Findings table structure

---

**SECTION 12: ETHICS & DISSEMINATION**

52. Ethical approval requirements (typically not needed for SR)
53. Protocol amendments procedure
54. Dissemination plans:
    - Target journals (list 3 in priority order)
    - Conference presentations
    - Data sharing policy

---

**SECTION 13: TIMELINE**

55. Projected timeline (week-by-week breakdown):
    - Protocol finalization: Week X
    - Search execution: Weeks X-X
    - Screening: Weeks X-X
    - Data extraction: Weeks X-X
    - Risk of bias: Weeks X-X
    - Analysis: Weeks X-X
    - Manuscript: Weeks X-X
    - Submission: Week X

---

**SECTION 14: KEYWORDS**

56. Generate 8-10 relevant keywords (MeSH terms and free-text)

---

**SECTION 15: REFERENCES**

57. Key methodological references (formatted):
    - PRISMA 2020
    - Cochrane Handbook
    - RoB 2.0 tool
    - GRADE
    - Statistical methods papers

---

**FORMATTING REQUIREMENTS:**

- Use clear section headers
- Number all sections for easy reference
- Use bullet points for lists
- Bold key terms
- Write in third person future tense ("We will..." not "I will...")
- Use precise, unambiguous language
- Avoid vague terms like "relevant studies" (specify what makes them relevant)
- Include justifications for methodological choices
- Maintain consistency in terminology throughout

**OUTPUT STRUCTURE:**

Provide the protocol in the following format:
    ", link: "#" },
            { id: "search", title: "Search Strategy", prompt: "Keywords and database strings.", link: "#" },
            { id: "abs-screen", title: "Abstract Screening", prompt: "Initial screening logs.", link: "#" },
            { id: "full-screen", title: "Full Text Screening", prompt: "Exclusion rationale.", link: "#" },
            { id: "prisma", title: "PRISMA Flow", prompt: "Identification and exclusion counts.", link: "#" },
            { id: "extraction", title: "Data Extraction", prompt: "Paste JSON array for table extraction.", link: "#" },
            { id: "missing", title: "Missing Data", prompt: "Author communication logs.", link: "#" },
            { id: "abstract", title: "Final Abstract", prompt: "Structured summary.", link: "#" },
            { id: "titlepage", title: "Title Page", prompt: "Authors and affiliations.", link: "#" },
            { id: "intro", title: "Introduction", prompt: "Gap analysis and objective.", link: "#" },
            { id: "methods", title: "Methods", prompt: "Statistical and review methods.", link: "#" },
            { id: "results", title: "Results", prompt: "Narrative synthesis or meta-analysis.", link: "#" },
            { id: "discussion", title: "Discussion", prompt: "Limitations and conclusions.", link: "#" }
        ];

        let projects = JSON.parse(localStorage.getItem('SRM_DATA_V4')) || [];
        let activeProjectId = null;
        let currentSectionIdx = 0;

        // --- THEME ---
        function toggleTheme() {
            const body = document.body;
            const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('SRM_THEME', newTheme);
        }

        // --- DASHBOARD ---
        function goDashboard() {
            activeProjectId = null;
            document.getElementById('view-dashboard').classList.remove('hidden');
            document.getElementById('view-project').classList.add('hidden');
            document.getElementById('hamburger').classList.add('hidden');
            document.getElementById('app-heading').innerText = "SYSTEMATIC REVIEW MANAGER";
            toggleMenu(false);
            renderDashboard();
        }

        function createNewProject() {
            const title = document.getElementById('new-title').value.trim();
            const desc = document.getElementById('new-desc').value.trim();
            if(!title) return alert("Title required");
            
            const newProject = { id: Date.now(), title, desc, data: {} };
            projects.push(newProject);
            save();
            document.getElementById('new-title').value = '';
            document.getElementById('new-desc').value = '';
            renderDashboard();
        }

        function renderDashboard() {
            const grid = document.getElementById('projectGrid');
            grid.innerHTML = projects.length ? '' : '<p>No projects found.</p>';
            projects.forEach(p => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `<h3>${p.title}</h3><p style="font-size: 0.8rem; opacity: 0.7;">${p.desc}</p>`;
                card.onclick = () => openProject(p.id);
                grid.appendChild(card);
            });
        }

        // --- NAVIGATION & VIEWS ---
        function openProject(id) {
            activeProjectId = id;
            currentSectionIdx = 0;
            const p = projects.find(x => x.id === id);
            
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-project').classList.remove('hidden');
            document.getElementById('hamburger').classList.remove('hidden');
            document.getElementById('app-heading').innerText = p.title;

            renderSidebar();
            showSection(0);
        }

        function showSection(idx) {
            currentSectionIdx = idx;
            const sec = SECTIONS[idx];
            const project = projects.find(p => p.id === activeProjectId);
            const savedData = project.data[sec.id] || "";

            const container = document.getElementById('section-container');
            container.innerHTML = `
                <div class="section-view active">
                    <h1>${sec.title}</h1>
                    <div style="background: var(--gray); padding: 15px; margin: 20px 0; border-left: 4px solid var(--text);">
                        <p style="font-size: 0.9rem;"><strong>PROMPT:</strong> ${sec.prompt}</p>
                        <a href="${sec.link}" target="_blank" style="color: var(--text); font-size: 0.8rem; font-weight: bold;">[RESOURCE LINK]</a>
                    </div>
                    <div class="editor-grid">
                        <textarea id="edit-${sec.id}" oninput="updateData('${sec.id}', this.value)" placeholder="Type here...">${savedData}</textarea>
                        <div class="rendered-view" id="render-${sec.id}">${parse(savedData)}</div>
                    </div>
                </div>
            `;
            
            updateNavUI();
            updateProgress();
        }

        function navigateSection(dir) {
            let next = currentSectionIdx + dir;
            if (next >= 0 && next < SECTIONS.length) showSection(next);
        }

        function updateNavUI() {
            // Update sidebar active state
            document.querySelectorAll('.nav-list a').forEach((a, i) => {
                a.classList.toggle('active', i === currentSectionIdx);
            });
            // Update Prev/Next buttons
            document.getElementById('prevBtn').disabled = currentSectionIdx === 0;
            document.getElementById('nextBtn').disabled = currentSectionIdx === SECTIONS.length - 1;
        }

        function renderSidebar() {
            const list = document.getElementById('navLinks');
            list.innerHTML = '';
            SECTIONS.forEach((s, i) => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="#" onclick="showSection(${i}); toggleMenu(); return false;">${s.title}</a>`;
                list.appendChild(li);
            });
        }

        function toggleMenu(force) {
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('overlay');
            if(force === false) {
                menu.classList.remove('open');
                overlay.classList.remove('show');
            } else {
                menu.classList.toggle('open');
                overlay.classList.toggle('show');
            }
        }

        // --- CORE LOGIC ---
        function updateData(secId, val) {
            const p = projects.find(x => x.id === activeProjectId);
            p.data[secId] = val;
            document.getElementById(`render-${secId}`).innerHTML = parse(val);
            save();
            updateProgress();
        }

        function parse(text) {
            if(!text) return '<span style="opacity: 0.4;">Preview...</span>';
            // JSON Detect
            if(text.trim().startsWith('[') && text.trim().endsWith(']')) {
                try {
                    const d = JSON.parse(text);
                    let h = '<table><thead><tr>' + Object.keys(d[0]).map(k => `<th>${k}</th>`).join('') + '</tr></thead><tbody>';
                    d.forEach(r => h += '<tr>' + Object.values(r).map(v => `<td>${v}</td>`).join('') + '</tr>');
                    return h + '</tbody></table>';
                } catch(e) {}
            }
            // Simple Markdown
            return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>').replace(/\n/g, '<br>');
        }

        function updateProgress() {
            const p = projects.find(x => x.id === activeProjectId);
            const filled = SECTIONS.filter(s => p.data[s.id] && p.data[s.id].trim()).length;
            const pct = (filled / SECTIONS.length) * 100;
            document.getElementById('side-progress').style.width = pct + '%';
        }

        function save() { localStorage.setItem('SRM_DATA_V4', JSON.stringify(projects)); }

        // --- INIT ---
        window.onload = () => {
            const savedTheme = localStorage.getItem('SRM_THEME');
            if(savedTheme) document.body.setAttribute('data-theme', savedTheme);
            goDashboard();
        };
    </script>
</body>
</html>
